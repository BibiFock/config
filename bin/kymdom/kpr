#!/bin/bash

if [ $# -eq 0 ]; then
    gh pr list --author "@me" -s open \
        --json url,title,updatedAt,number,headRefName,reviewDecision,mergeStateStatus,isDraft \
        --template '{{tablerow "#ID" "BRANCH" "REVIEW" "STATUS" "DRAFT"}}{{range .}}{{tablerow (printf "#%v" .number | autocolor "yellow") .headRefName .reviewDecision .mergeStateStatus .isDraft}}{{end}}'
    exit
fi

gh pr view $1 --json url,number,title,reviews,assignees,headRefName,reviewDecision,updatedAt,mergeStateStatus,mergeable \
    --template '{{(timeago .updatedAt | autocolor "green")}} {{(hyperlink .url (printf "#%v" .number | autocolor "yellow"))}} {{.title}}

{{.headRefName}} {{.reviewDecision}} {{.mergeStateStatus}}

{{tablerow "REVIEWER" "STATE" "COMMENT" "SUBMITTED"}}{{range .reviews}}{{tablerow .author.login .state .body (timeago .submittedAt)}}{{end}}
'
