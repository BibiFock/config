#!/usr/bin/env bash

COLOR_RESET="\\033[0m"
COLOR_YELLOW="\\033[33m"
COLOR_GREEN="\\033[32m"
COLOR_RED="\\033[31m"
COLOR_MAGENTA="\\033[35m"
COLOR_BOLD="\\e[1m"

if [ $# -eq 0 ]; then
	echo
	echo -e $COLOR_YELLOW"Please at list add a commit message ;)"$COLOR_RESET
	echo
	exit 1
fi

MESSAGE=$1
TYPE=${2:-"feat"}
TYPES=$(echo build chore ci docs feat fix perf refactor revert style test)

if [[ ! ${TYPES[*]} =~ "${TYPE}"( |$) ]]; then
	echo
	echo -e "$COLOR_RED \xE2\x9D\x8C ${COLOR_RESET}type must be one of ${COLOR_YELLOW}[$TYPES] $COLOR_RESET"
	echo
	exit 1
fi

PACKAGES=$(git diff --name-only --cached \
	| extractPackages \
	| tr '\n' ',' \
	| sed -e 's/,$//g'
)

BRANCH_NAME=$(git rev-parse --abbrev-ref HEAD | sed -e 's,.*/\(.*\),\1,' | sed s/\\./-/g | sed s/_/-/g)
ISSUE=$(echo $BRANCH_NAME | cut -d"-" -f 1)


COMMIT_MESSAGE="$TYPE($PACKAGES): #$ISSUE $MESSAGE"

git commit -m "$COMMIT_MESSAGE"
