#!/bin/bash

RESET="\\033[0m"
YELLOW="\\033[33m"
GREEN="\\033[32m"
RED="\\033[31m"
MAGENTA="\\033[35m"

function step {
    echo -e $YELLOW-------------------------------------------------------- [$1]$RESET
}

PROJECTS=$(echo bibli lirelu)
HOME_DEV=$HOME/dev/envs_test/

GLOB=()
GLOB_DEFAULT=()
for p in $PROJECTS
do
    GLOB+=" *-${p}"
    GLOB_DEFAULT+=" ${p}"
done

PATHS="$(ls -d $GLOB) $(ls -d $GLOB_DEFAULT)"

for path in $PATHS
do
    log="$(cd $HOME_DEV$path; git -c color.ui=always --no-pager log -1 --pretty="%C(auto)%d %C(green)%cd %Creset" --date=relative)"
    if [[ "$path" == *"-"* ]]; then
        env=$(echo $path |cut -f1 -d"-")
        project=$(echo $path |cut -f2 -d"-")
    else
        env="default"
        project=$path
    fi

    if [ "$env" != "$currEnv" ]; then
        echo "[$env]"
        currEnv=$env
    fi

    echo " - "$project $log
done
